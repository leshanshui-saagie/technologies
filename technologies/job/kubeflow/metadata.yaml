version: v1
id: kubeflow
label: Kubeflow
description: "Kubeflow instance gestion"
available: false
type: EXTERNAL_JOB
icon: job

contexts:
  - id: clone-run
    label: Clone run
    description: "Clone run context"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: kubeflow
    parameters:
      - type: DYNAMIC_SELECT
        id: pipeline
        label: Pipeline
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelines
      - type: DYNAMIC_SELECT
        id: pipelineVersion
        label: Pipeline version
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelineVersions
        dependsOn:
          - pipeline
      - type: DYNAMIC_SELECT
        id: experiment
        label: Experiment
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getExperiments
        dependsOn:
          - pipelineVersion
      - type: DYNAMIC_SELECT
        id: run
        label: Run
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getRuns
        dependsOn:
          - experiment
      - type: TEXT
        id: runName
        label: Run name
        mandatory: true
        dependsOn:
          - run
      - type: TEXT
        id: runDescription
        label: Run description
        mandatory: false
        dependsOn:
          - run
    actions:
      start:
        script: .//dist/clone-actions.js
        function: start
      stop:
        script: .//dist/actions.js
        function: stop
      getStatus:
        script: .//dist/actions.js
        function: getStatus
      getLogs:
        script: .//dist/actions.js
        function: getLogs
  - id: new-run
    label: New run
    description: "New run context"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: kubeflow
    parameters:
      - type: DYNAMIC_SELECT
        id: pipeline
        label: Pipeline
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelines
      - type: DYNAMIC_SELECT
        id: pipelineVersion
        label: Pipeline version
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelineVersions
        dependsOn:
          - pipeline
      - type: DYNAMIC_SELECT
        id: experiment
        label: Experiment
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getExperiments
        dependsOn:
          - pipelineVersion
      - type: TEXT
        id: runName
        label: Run name
        mandatory: true
        dependsOn:
          - experiment
      - type: TEXT
        id: runDescription
        label: Run description
        mandatory: false
        dependsOn:
          - experiment
      - type: TEXT
        id: runParameters
        label: Run parameters (JSON format)
        comment: JSON array of objects (name and value as properties)
        mandatory: false
        dependsOn:
          - experiment
    actions:
      start:
        script: .//dist/new-actions.js
        function: start
      stop:
        script: .//dist/actions.js
        function: stop
      getStatus:
        script: .//dist/actions.js
        function: getStatus
      getLogs:
        script: .//dist/actions.js
        function: getLogs
  - id: retry-run
    label: Retry run
    description: "Retry run context"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: kubeflow
    parameters:
      - type: DYNAMIC_SELECT
        id: pipeline
        label: Pipeline
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelines
      - type: DYNAMIC_SELECT
        id: pipelineVersion
        label: Pipeline version
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getPipelineVersions
        dependsOn:
          - pipeline
      - type: DYNAMIC_SELECT
        id: experiment
        label: Experiment
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getExperiments
        dependsOn:
          - pipelineVersion
      - type: DYNAMIC_SELECT
        id: run
        label: Run
        mandatory: true
        dynamicValues:
          script: .//dist/job-form.js
          function: getRuns
        dependsOn:
          - experiment
    actions:
      start:
        script: .//dist/retry-actions.js
        function: start
      stop:
        script: .//dist/actions.js
        function: stop
      getStatus:
        script: .//dist/actions.js
        function: getStatus
      getLogs:
        script: .//dist/actions.js
        function: getLogs
