(this.webpackJsonp=this.webpackJsonp||[]).push([["tc-story-highlighted-kpi-editor"],{"/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/slide-editor/component-editor/index.js":function(e,t,i){"use strict";i.r(t);var s=i("/app/node_modules/lodash/lodash.js"),a=i.n(s),o=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/dataset-manager/index.coffee"),n=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/slide-editor/dataset-viewer/index.coffee 4c214810d10272111723bc8989bca38d"),d=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/services/dataset-utils.js"),r=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/data-request-editor/index.coffee 16384af8c3267eed3c1fd8984f2368e0"),p=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/data-request-editor/empty-placeholder/index.coffee"),c=i("/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/app/scripts/utils/components/redimentionnable-panels/index.vue 7bd2f4d9b3bd768fa783f43d78d16f09"),l=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/slide/slide-data-warehouse-mixin.coffee"),u=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/utils/preview/index.coffee"),h=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/slide/tc-story.js 2771b1fa2a3d37a0de7429dc4b0c0590"),m=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/slide-editor/suggestion.coffee"),f=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/slide-editor/story-config-utils.js"),_=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/params.coffee"),b=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/slide-editor/dataset-utils.js"),g=i("/app/node_modules/vue-template-loader/lib/template-loader.js??ref--1-oneOf-1-0!/app/node_modules/pug-plain-loader/index.js!/app/app/scripts/studio/slide-editor/component-editor/component-editor.vue.pug"),v=i.n(g),y=i("/app/node_modules/weaverbird/dist/weaverbird.esm.js");function D(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var w=!1,x=Object(y.e)("mongo36");t.default=v()({name:"component-editor",mixins:[Object(l.a)()],components:{RedimentionnablePanels:c.a,DataRequestEditor:r.a,DatasetManager:o.default,DatasetViewer:n.a,EmptyPlaceholder:p.a,Preview:u.a,TcModal:function(){return Promise.resolve().then(i.bind(null,"/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/utils/components/tc-modal/index.js"))},TcStory:h.a,QueryBuilder:y.b,DataViewer:y.a},props:{dataApi:{type:Object,default:function(){return{get:function(){return Promise.resolve([])},basemaps:{query:function(){return Promise.resolve([])}}}}},story:{type:Object,default:function(){return{}}},initialSelectedDatasetId:{type:String,default:function(){}},componentEditorTKey:{type:String,default:function(){return"studio.component_editor.title"}}},data:function(){return{selectedDatasetId:this.initialSelectedDatasetId,tabName:"queryOptions",isSwitchToCodeModalOpened:!1,unsubscribeMutationWatcher:void 0}},computed:{currentDataset:function(){return a.a.find(this.datasetsList,{id:this.selectedDatasetId})},currentDatasetPrecision:function(){return this.currentDataset.config.precision},currentDatasetSentiment:function(){return this.currentDataset.config.sentiment},currentDatasetUnits:function(){return this.currentDataset.config.units},currentDatasetDataRequest:function(){return Object(b.c)(this.datasetsConfigs[this.selectedDatasetId])},datasetsConfigs:function(){return d.a.findDatasetsParamsInSlide(this.story)},datasetsIds:function(){return a.a.keys(this.datasets)},datasetsList:function(){return a.a.map(this.datasets,function(e,t){return a.a.assign({id:t},e)})},isComponentOptionsTabActive:function(){return"componentOptions"===this.tabName},isDataRequestEmpty:function(){return void 0===this.currentDatasetDataRequest||a.a.isEmpty(this.currentDatasetDataRequest)||a.a.isEqual(this.currentDatasetDataRequest,f.a)},isQueryOptionsTabActive:function(){return"queryOptions"===this.tabName},isVisualQueryBuilderMode:function(){return!(!w||!this.isDataRequestEmpty&&!this.pipeline)},pipeline:function(){var e=a.a.defaultTo(this.selectedDatasetId,o.DEFAULT_DATASET_NAME);return this.story.datasets[e]?this.story.datasets[e].pipeline:[]},suggestions:function(){return Object(b.e)(this.datasetsList)},templatedConfig:function(){return this.$store.getters.parseTemplate(this.story)}},created:function(){(w=_.c.VISUAL_QUERY_BUILDER_ENABLED)&&Object(y.g)(this.$store,{interpolateFunc:function(e,t){return a.a.template(e)(t)},variables:{appRequesters:this.$store.getters.allState.appRequesters,requestersManager:this.$store.getters.allState.requestersManager}}),this.t=this.$store.getters.translateBatch([this.componentEditorTKey,"studio.data_request_editor.title","confirmation_modal.code_mode.title","confirmation_modal.code_mode.message","confirmation_modal.cancel","confirmation_modal.confirm"])},destroyed:function(){w&&(Object(y.i)(this.$store),this.unsubscribeMutationWatcher&&this.unsubscribeMutationWatcher())},mounted:function(){var e=this;w&&(this.unsubscribeMutationWatcher=this.$store.subscribe(function(t){t.type===Object(y.d)("selectStep")||t.type===Object(y.d)("setCurrentDomain")||t.type===Object(y.d)("deleteStep")?e.updateStory(e.story):"SET_AVAILABLE_DOMAINS"===t.type&&e.$store.commit(Object(y.d)("setDomains"),{domains:t.payload})})),a.a.isUndefined(this.selectedDatasetId)&&(this.selectedDatasetId=a.a.first(this.datasetsIds)),this.isDataRequestEmpty||this.showEditor("componentOptions"),w&&(this.$store.getters.availableDomains&&this.$store.getters.availableDomains.length&&this.$store.commit(Object(y.d)("setDomains"),{domains:this.$store.getters.availableDomains}),this.updateVQBStore())},watch:{datasetsIds:function(){a.a.includes(this.datasetsIds,this.selectedDatasetId)||(this.datasetsIds.length>0?this.selectedDatasetId=this.datasetsIds[0]:this.selectedDatasetId=o.DEFAULT_DATASET_NAME)},datasetsConfigs:function(e){this.updateDatasetsConfigs(e),"__fake_data__"===a.a.get(e[this.selectedDatasetId],"query.domain")&&this.showEditor("componentOptions")}},methods:{addDataset:function(e,t){this.selectDatasetById(e),this.isVisualQueryBuilderMode&&(this.$store.commit(Object(y.d)("setPipeline"),{pipeline:[]}),this.$store.commit(Object(y.d)("setDataset"),{dataset:{data:[],headers:[]}})),this.updateStory(t),this.tabName="queryOptions"},selectDatasetById:function(e){this.selectedDatasetId=null!=e?e:this.datasetsIds[0],this.isVisualQueryBuilderMode&&this.updateVQBStore()},selectDomain:function(e){this.$store.commit(Object(y.d)("setCurrentDomain"),{currentDomain:a.a.get(e,"query.domain")})},showEditor:function(e){this.tabName=e},transformDataQuery:function(e){var t=this.datasets[this.selectedDatasetId],i=e(a.a.cloneDeep(Object(b.d)(t))),s=a.a.cloneDeep(this.story);a.a.merge(s,{datasets:D({},this.selectedDatasetId,a.a.clone(t.config))}),Object(b.i)(s.datasets[this.selectedDatasetId],i),this.updateStory(s)},updateVQBStore:function(){this.pipeline&&this.pipeline.length&&(this.$store.commit(Object(y.d)("setPipeline"),{pipeline:this.pipeline}),this.$store.commit(Object(y.d)("selectStep"),{index:this.pipeline.length-1}))},displayQueryEditor:function(){this.isVisualQueryBuilderMode&&this.updateVQBStore(),this.showEditor("queryOptions")},openSwitchToCodeModal:function(){this.isSwitchToCodeModalOpened=!0},closeSwitchToCodeModal:function(){this.isSwitchToCodeModalOpened=!1},switchToCodeMode:function(){var e=a.a.cloneDeep(this.story);delete e.datasets[this.selectedDatasetId].pipeline,this.updateStory(e,!1),this.closeSwitchToCodeModal()},updateStory:function(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.isVisualQueryBuilderMode&&this.isQueryOptionsTabActive){var t=e.datasets[this.selectedDatasetId],i=this.$store.state[y.c].pipeline,s=x.translate(i);(e=a.a.cloneDeep(e)).datasets[this.selectedDatasetId].pipeline=a.a.cloneDeep(i),a.a.merge(e,{datasets:D({},this.selectedDatasetId,a.a.clone(t.config))}),s.length&&Object(b.i)(e.datasets[this.selectedDatasetId],s)}this.$emit("storyUpdated",e)},updateDatasetDataRequest:function(e){var t=a.a.defaultTo(this.selectedDatasetId,o.DEFAULT_DATASET_NAME),i=a.a.cloneDeep(this.story);a.a.merge(i,{datasets:D({},t,{})}),Object(b.h)(i.datasets[t],e),this.updateStory(i)},updateDatasetsConfigs:function(e){var t=this;a.a.each(e,function(e,i){null!=t.datasets[i]&&(t.datasets[i].config=e)})},updateMetaConfig:function(e,t,i){var s;null==i&&(i=this.selectedDatasetId),s=this.story.datasets&&this.story.datasets[i]?a.a.extend({},this.story.datasets[i][t],e):e;var o=a.a.merge(a.a.cloneDeep(this.story),{datasets:D({},i,D({},t,{}))});o.datasets[i][t]=s,this.updateStory(o)},updateStoryPrecision:function(e,t){this.updateMetaConfig(e,"precision",t)},updateStorySentiment:function(e,t){this.updateMetaConfig(e,"sentiment",t)},updateStoryUnits:function(e,t){this.updateMetaConfig(e,"units",t)},provideSuggestions:function(e){var t=this;return function(i){return Object(m.a)(t.suggestions)(e)(i)}}}})},"/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/utils/preview/index.coffee":function(e,t,i){"use strict";var s,a,o=i("/app/node_modules/vue-clickaway/dist/vue-clickaway.common.js"),n=i.n(o),d=i("/app/node_modules/vue-template-loader/lib/template-loader.js??ref--1-oneOf-1-0!/app/node_modules/pug-plain-loader/index.js!/app/app/scripts/studio/utils/preview/preview.vue.pug");s={NORMAL:"normal",EXPANDED:"expanded",MINIMIZED:"minimized"},a=i.n(d)()({mixins:[n.a.mixin],props:{scale:{type:Number,default:.2,validator:function(e){return 0<e&&e<=1}},margin:{type:Number,default:25}},data:function(){return{mode:s.NORMAL,viewport:{width:window.innerWidth,height:window.innerHeight}}},created:function(){return this.PREVIEW_MODES=s},computed:{canCompress:function(){return this.mode!==s.MINIMIZED},canExpand:function(){return this.mode!==s.EXPANDED},shouldDisplayContent:function(){return this.mode!==s.MINIMIZED},contentSize:function(){return{width:this.viewport.width-2*this.margin,height:this.viewport.height-2*this.margin}},normalStyle:function(){return{container:{bottom:this.margin+"px",right:this.margin+"px",width:this.contentSize.width*this.scale+"px",height:this.contentSize.height*this.scale+"px"},content:{width:this.contentSize.width+"px",height:this.contentSize.height+"px",transform:"scale3d("+this.scale+", "+this.scale+", 1)"}}},expandedStyle:function(){var e,t,i,s;return t=(i=this.$parent.$el).clientWidth-2*this.margin,e=i.clientHeight-2*this.margin,s=Math.min(t/this.contentSize.width,e/this.contentSize.height),{container:{bottom:(i.clientHeight-this.contentSize.height*s)/2+"px",right:(i.clientWidth-this.contentSize.width*s)/2+"px",width:this.contentSize.width*s+"px",height:this.contentSize.height*s+"px"},content:{width:this.contentSize.width+"px",height:this.contentSize.height+"px",transform:"scale3d("+s+", "+s+", 1)"}}},minimizedStyle:function(){return{container:{bottom:"25px",right:"25px",width:"0px",height:"0px"},content:{width:this.contentSize.width+"px",height:this.contentSize.height+"px",transform:"scale3d("+this.scale+", "+this.scale+", 1)"}}},currentStyle:function(){switch(this.mode){case s.EXPANDED:return this.expandedStyle;case s.MINIMIZED:return this.minimizedStyle;default:return this.normalStyle}}},methods:{refreshViewport:function(){return this.viewport={width:window.innerWidth,height:window.innerHeight}},compress:function(){return this.mode===s.EXPANDED?this.mode=s.NORMAL:this.mode=s.MINIMIZED},expand:function(){return this.mode===s.MINIMIZED?this.mode=s.NORMAL:this.mode=s.EXPANDED},onClickAway:function(){if(this.mode===s.EXPANDED)return this.compress()}}}),t.a=a},"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/app/scripts/studio/slide-editor/highlighted-kpi-editor/index.vue de46f6fa4dc197f5e0b4ee612b841e77":function(e,t,i){"use strict";i.r(t);var s=i("/app/node_modules/lodash/lodash.js"),a=i.n(s),o=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/charts/highlighted-kpi/config-processor.js 151e595ee355f4fe30ff161682a73671"),n=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/slide-editor/component-editor/index.js"),d=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/chart-options-editor/form-builder/index.js"),r=i("/app/build/webpack/loaders/json-schema-loader.js!/app/app/schemas/front_config/slides/slide_options/highlighted_kpi_options/highlighted_kpi_options_schema.json"),p=i.n(r),c=i("/app/node_modules/babel-loader/lib/index.js!/app/app/scripts/studio/chart-options-editor/json-to-ui-schema.js"),l=i("/app/node_modules/babel-loader/lib/index.js!/app/node_modules/coffee-loader/index.js!/app/app/scripts/studio/slide-editor/suggestion.coffee"),u={name:"highlighted-kpi-options-editor",components:{FormBuilder:d.a},props:{options:{type:Object,default:function(){return{}}},suggestions:{type:Array,default:function(){return[]}}},computed:{formUiSchema:function(){return Object(c.b)(p.a)},provideOptionsSuggestions:function(){return Object(l.a)(this.suggestions)}},methods:{updateOptions:function(e){this.$emit("optionsUpdated",e)}}},h=i("/app/node_modules/vue-loader/lib/runtime/componentNormalizer.js"),m=Object(h.a)(u,function(){var e=this,t=e.$createElement;return(e._self._c||t)("form-builder",{attrs:{"auto-save":"","initial-value":e.options,"suggestions-provider":e.provideOptionsSuggestions,"ui-schema":e.formUiSchema},on:{formSaved:function(t){return e.updateOptions(t)}}})},[],!1,null,null,null).exports,f={name:"highlighted-kpi-editor",components:{ComponentEditor:n.default,HighlightedKpiOptionsEditor:m},props:{dataApi:{type:Object},index:{type:Number,default:0},story:{type:Object,required:!0}},computed:{options:function(){return this.story.highlightedKpis[this.index]},storyDatasetIds:function(){return Object.keys(this.story.datasets)},defaultSelectedDatasetId:function(){return Object(o.a)(this.options,this.storyDatasetIds)}},methods:{updateStory:function(e){this.$emit("storyUpdated",e)},updateOptions:function(e){var t=a.a.isUndefined(this.story.highlightedKpis)?[]:a.a.cloneDeep(this.story.highlightedKpis);t[this.index]=e,this.updateStory(a.a.assign({},this.story,{highlightedKpis:t}))}}},_=Object(h.a)(f,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("component-editor",e._b({attrs:{"component-editor-t-key":"studio.highlighted_kpi_editor.title","initial-selected-dataset-id":e.defaultSelectedDatasetId},on:{storyUpdated:e.updateStory},scopedSlots:e._u([{key:"default",fn:function(t){return i("highlighted-kpi-options-editor",{attrs:{options:e.options,suggestions:t.suggestions},on:{optionsUpdated:function(t){return e.updateOptions(t)}}})}}])},"component-editor",e.$props,!1))},[],!1,null,null,null);t.default=_.exports},"/app/node_modules/vue-template-loader/lib/template-loader.js??ref--1-oneOf-1-0!/app/node_modules/pug-plain-loader/index.js!/app/app/scripts/studio/slide-editor/component-editor/component-editor.vue.pug":function(e,t){var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"component-editor"},[i("redimentionnable-panels",{attrs:{direction:"horizontal"}},[i("div",{staticClass:"slide-editor__panel",attrs:{slot:"panel-1"},slot:"panel-1"},[i("div",{staticClass:"slide-editor__header"},[i("div",{staticClass:"editor-manager"},[i("div",{ref:"componentOptionsEditorButton",staticClass:"editor-manager__choice",class:{"editor-manager__choice--active":e.isComponentOptionsTabActive},on:{click:function(t){return e.showEditor("componentOptions")}}},[e._v(e._s(e.t[e.componentEditorTKey]))]),i("div",{ref:"dataRequestEditorButton",staticClass:"editor-manager__choice",class:{"editor-manager__choice--active":e.isQueryOptionsTabActive},on:{click:e.displayQueryEditor}},[e._v(e._s(e.t["studio.data_request_editor.title"]))])]),i("div",{staticClass:"switch-mode__container"},[e.isVisualQueryBuilderMode?i("button",{staticClass:"switch-mode__button",on:{click:e.openSwitchToCodeModal}},[e._v("Swith to code mode")]):i("div",{staticClass:"switch-mode__code-mode"},[e._v("Code mode")])])]),i("div",{staticClass:"slide-editor__scrollable-zone"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isComponentOptionsTabActive,expression:"isComponentOptionsTabActive"}],ref:"componentOptionsEditor",staticClass:"story-editor__component-options-editor"},[e._t("default",null,{selectedDatasetId:e.selectedDatasetId,suggestions:e.suggestions,suggestionsProvider:e.provideSuggestions})],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isQueryOptionsTabActive&&!e.isVisualQueryBuilderMode,expression:"isQueryOptionsTabActive && !isVisualQueryBuilderMode"}],ref:"dataRequestEditor",staticClass:"datasets-editor"},[e.currentDataset?i("data-request-editor",{attrs:{"data-request":e.currentDatasetDataRequest},on:{dataRequestUpdated:e.updateDatasetDataRequest}}):e._e()],1),e.isQueryOptionsTabActive&&e.isVisualQueryBuilderMode?i("div",{staticClass:"weaverbird"},[e.isDataRequestEmpty?i("empty-placeholder",{staticClass:"data-request-editor__empty-placeholder",on:{dataRequestUpdated:e.selectDomain}}):i("query-builder")],1):e._e()])]),i("div",{staticClass:"slide-editor__panel",attrs:{slot:"panel-2"},slot:"panel-2"},[i("dataset-manager",{attrs:{config:e.story,"selected-dataset-id":e.selectedDatasetId},on:{configUpdated:function(t){return e.updateStory(t)},datasetIdSelected:function(t){return e.selectDatasetById(t)},addDataset:e.addDataset}}),e.isVisualQueryBuilderMode&&e.isQueryOptionsTabActive?i("div",{staticClass:"data-viewer--query-builder"},[i("data-viewer")],1):i("div",{staticClass:"datasets-viewer--options-editor"},[i("div",{staticClass:"datasets-viewer__header"},[i("div",{staticClass:"datasets-viewer__title"},[e._v("Dataset viewer")])]),e.currentDataset&&e.currentDataset.nestedData?i("dataset-viewer",{attrs:{dataset:e.currentDataset,precision:e.currentDatasetPrecision,sentiment:e.currentDatasetSentiment,suggestions:e.suggestions,units:e.currentDatasetUnits,isDrillable:e.currentDataset.isDrillable,isLazy:e.currentDataset.isLazy,formattable:!0},on:{mongoExport:e.transformDataQuery,precisionUpdated:e.updateStoryPrecision,sentimentUpdated:e.updateStorySentiment,unitUpdated:e.updateStoryUnits}}):e._e()],1)],1)]),e.isSwitchToCodeModalOpened?i("tc-modal",{on:{closed:e.closeSwitchToCodeModal}},[i("div",{staticClass:"tc-modal__header"},[i("div",{staticClass:"tc-modal__title"},[e._v(e._s(e.t["confirmation_modal.code_mode.title"]))])]),i("div",{staticClass:"tc-modal__section"},[i("strong",{staticClass:"tc-modal__text"},[e._v(e._s(e.t["confirmation_modal.code_mode.message"]))])]),i("div",{staticClass:"tc-modal__footer"},[i("div",{staticClass:"tc-modal__action tc-modal__action--secondary",on:{click:e.closeSwitchToCodeModal}},[e._v(e._s(e.t["confirmation_modal.cancel"]))]),i("div",{staticClass:"tc-modal__action tc-modal__action--primary",on:{click:e.switchToCodeMode}},[e._v(e._s(e.t["confirmation_modal.confirm"]))])])]):e._e(),i("preview",{attrs:{scale:.2}},[i("tc-story",{attrs:{config:e.story,dataApi:e.dataApi,debugPanelEnabled:!1,editable:!1,isPreview:!0}})],1)],1)},s=[];e.exports=function(e){var t="function"==typeof e?e.options:e;return t.render=i,t.staticRenderFns=s,e}},"/app/node_modules/vue-template-loader/lib/template-loader.js??ref--1-oneOf-1-0!/app/node_modules/pug-plain-loader/index.js!/app/app/scripts/studio/utils/preview/preview.vue.pug":function(e,t){var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"on-clickaway",rawName:"v-on-clickaway",value:e.onClickAway,expression:"onClickAway"}],staticClass:"preview",class:"preview--"+e.mode,style:e.currentStyle.container},[i("div",{staticClass:"preview__wrapper"},[i("div",{staticClass:"preview__content",style:e.currentStyle.content},[e.shouldDisplayContent?e._t("default"):e._e()],2)]),i("div",{staticClass:"preview__actions"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.canCompress,expression:"canCompress"}],staticClass:"preview__action preview__action--compress",on:{click:e.compress}},[i("div",{staticClass:"fa fa-compress"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.canExpand,expression:"canExpand"}],staticClass:"preview__action preview__action--expand",on:{click:e.expand}},[i("div",{staticClass:"fa fa-expand"})])])])},s=[];e.exports=function(e){var t="function"==typeof e?e.options:e;return t.render=i,t.staticRenderFns=s,e}}}]);